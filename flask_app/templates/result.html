{% extends 'base.html' %}
{% import "bootstrap/wtf.html" as wtf %}


{% import "bootstrap/wtf.html" as wtf %}
{# Imports 'wtf.html' from the 'bootstrap' directory with an alias 'wtf' #}

{% block title %}
Result Page
{% endblock %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
<!-- Include Cytoscape.js library -->
<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
<script src="https://unpkg.com/dagre@0.7.4/dist/dagre.js"></script>
<script src="static/cytoscape-dagre.js"></script>

<style>
   
 #cy {
       position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        text-align: initial;
        z-index: 999;
 }
 #imgg
 {
        position: absolute;
        z-index: 99999;
        margin: 1em;
 }
</style>
<script>
    // After including Cytoscape.js and Cytoscape-Dagre layout extension
document.addEventListener('DOMContentLoaded', function(){ 
    $.get('/nameList', function(x) 
    {
        let dataFactorTitle = x;
        let myList=[];
        for (var i = 0; i < dataFactorTitle.length; i++) 
        {
            myList.push({data:{id:String(i),label:dataFactorTitle[i]}})
        }
        $.get('/confusionList', function(x) 
        {
            let edgeInfo = x;
            let edgeList=[];
            console.log(edgeList)   
            for (var i = 0; i < edgeInfo.length; i+=2) 
            {
            edgeList.push({ data: { source: String(edgeInfo[i]), target: String(edgeInfo[i+1]) }})
            }
            console.log(edgeList)   
            let cy = cytoscape({
                        container: document.getElementById('cy'),
                        boxSelectionEnabled: false,
                        autounselectify: false,
                        layout: { name: 'dagre',rankDir: 'LR'},
                        style: 
                        [
                            {
                                selector: 'node',
                                style: {
                                    'background-color': '#11479e',
                                    'content': 'data(label)', 
                                    'text-wrap':'wrap',
                                    'text-max-width':'47%',
                                    'font-size':'5px',
                                    'text-halign':'center',
                                    'text-valign':'center',
                                    'padding': '10px'
                                    

                                    

                                    
                                }
                            },
                            {
                                selector: 'edge',
                                style: {
                                    'width': 1,
                                    'target-arrow-shape': 'triangle',
                                    'line-color': '#9dbaea',
                                    'target-arrow-color': '#9dbaea',
                                    'curve-style': 'bezier'
                                }
                            }
                        ],
                        elements: 
                        {
                            nodes: myList,
                            edges: edgeList
                        }
                    });
                    document.querySelector('#imgg').addEventListener('click', function() {
                    const base64URI = cy.png();
                    var download = document.createElement('a');
                    download.href = base64URI;
                    download.download = 'Visual.png';
                    download.click();

                    
                    
                    });  
            });
        });   
      
    });

    
    </script>

{% endblock %}


{% block content %}
<div class="grid-container">
    <div class="resultPage">
        <div id="cy"></div>
        <div id="buttons">
            <button id="imgg">Download Visual</button>
        </div>
    </div>
</div>




{% endblock %}
