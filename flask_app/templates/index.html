{% extends 'base.html' %}
{# Extends the 'base.html' template #}

{% import "bootstrap/wtf.html" as wtf %}
{# Imports 'wtf.html' from the 'bootstrap' directory with an alias 'wtf' #}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
{% endblock %}

{% block title %}
  ISM Home
  {# Sets the title of the page to "ISM Home" #}
{% endblock %}

<link rel="stylesheet" href="index.css">

{% block content %}
  <div class="grid-container">
      <div class="gettingStarted">
        <h1 class="pt-5 pb-2">Getting Started</h1>
        {# Heading for the page #}
        <p class="welcome"> Welcome to the ISM app. 
          This is an open source tool for conducting Interpretive Structural Modeling (ISM) research with participants to 
          produce a visual that helps a group of people solve a collective problem. 
          This app takes in a list of factors identified by research participants that affect a specific problem. 
          It will then work with participants to figure out the relationships between factors (things that impact their ability to act). 
          An algorithm will then determine which factors should be addressed first, second, and so on in order for the group to meet their goals.</p>
          <br><p style="text-align: center; font-size: 18px;">Click on the About Page to learn more, or Help for instructions.</p>
          
        <p><a href="about"><button class="goToAbout">Go To About</button></a><a href="help"><button class="goToAbout">Help</button></a></p>
      </div>
  <!-- Load section -->

  <div class="loadContainer">
    <div class="shared-style">
        <h4>Upload Data</h4>
        <input type="file" id="fileInput" style="display: none;" accept=".csv" onchange="uploadFile(this.getAttribute('data-type'))">
       
        <div class="load">
          <button onclick="triggerFileInput('factor')" class="loadButton">Upload Factors</button>
        </div>

        <div class="load">
          <button onclick="triggerFileInput('participant')" class="loadButton">Upload Participants</button>
        </div>

        <div class="load">
          <button onclick="triggerFileInput('rating')" class="loadButton">Upload Ratings</button>
        </div>

      </div>
</div>
  <!-- Export section-->
  <div class="exportContainer">
    <div class="shared-style">
      <h4>Export</h4>
      <!-- TODO: add links to factors, participants,
        ratings, and results (clickable option) -->
        <form action="/export_data" method="post">
          <div class="export">
            <button class="exportButton" type="submit" name="data_type" value="factors">Export Factors</button>
          </div>
          <div class="export">
            <button class="exportButton" type="submit" name="data_type" value="participants">Export Participants</button>
          </div>
          <div class="export">
            <button class="exportButton" type="submit" name="data_type" value="ratings">Export Ratings</button>
          </div>
        </form>
    </div>
  </div>
</div>
<div class="templateFile">
  <div class="shared-style">
    <h4>Template File</h4>   
        <div class="export">
          <a href="static/factors.csv" download="Factors.CSV">
            <button  class="exportButton" type="button">Template Factor File</button>
        </a>
        </div>
        <div class="export">
          <a href="static/participant.csv" download="Participant.CSV">
            <button  class="exportButton" type="button">Template Participant File</button>
        </a>
        </div>
        <div class="export">
        <a href="static/rating.csv" download="Rating.CSV">
          <button  class="exportButton" type="button">Template Rating File</button>
      </a>
  </div>
</div>
</div>


<script>
  function triggerFileInput(type) {
      var fileInput = document.getElementById('fileInput');
      fileInput.setAttribute('data-type', type); // Set the type of data to upload
      fileInput.click();
  }
  
  function uploadFile(dataType) {
      var fileInput = document.getElementById('fileInput');
      if(fileInput.files.length > 0) {
          var formData = new FormData();
          formData.append('csv_upload', fileInput.files[0]);
          formData.append('data_type', dataType); // Include the data type in the FormData
  
          fetch('/upload_csv', {
              method: 'POST',
              body: formData
          })
          .then(response => response.json())
          .then(data => {
              console.log(data);
              // Handle success or redirect
          })
          .catch(error => {
              console.error('Error:', error);
          });
      }
  }
  </script>

  <!-- /**
 * Triggers the file input element to open the file selection dialog.
 * @param {string} type - The type of data to upload.
 */
function triggerFileInput(type) {
    var fileInput = document.getElementById('fileInput');
    fileInput.setAttribute('data-type', type); // Set the type of data to upload
    fileInput.click();
}

/**
 * Uploads the selected file to the server.
 * @param {string} dataType - The type of data being uploaded.
 */
function uploadFile(dataType) {
    var fileInput = document.getElementById('fileInput');
    if (fileInput.files.length > 0) {
        var formData = new FormData();
        formData.append('csv_upload', fileInput.files[0]);
        formData.append('data_type', dataType); // Include the data type in the FormData

        fetch('/upload_csv', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            // Handle success or redirect
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
} -->
</script>
{% endblock %}