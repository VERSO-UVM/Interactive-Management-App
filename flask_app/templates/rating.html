{% extends 'base.html' %}
{% import "bootstrap/wtf.html" as wtf %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/rating.css') }}">
{% endblock %}

{% block title %}
Ratings Page
{% endblock %}

{% block content %}
<div class="grid-container">
  <div class="ratingPage">
      <h1 class="pt-5 pb-2">Rating the Factors</h1>
      <h3>The participant id correspond to the order all users were entered! Answer a few questions and proceed to the final results. 
        Another user can also answer these questions, by the Choose Next Participant button, which allows the user to select another ID.
      </h3>
  </div>

  <div class="addRating">
    <div class="ratingContainer">
        <h4>Compare Factors</h4>
        <div class="box">
          
            <div id="part">
              <p class="IDs">Participant ID:</p>
              <p id="partID" class="IDs">{{person.id}}</p>
            </div>

            <p class="guide">Does the top factor affect the bottom factor?</p>
            </div>
              <p id="fLeading" class="factors"></p>
              <img src="{{ url_for('static', filename='Arrow.png')}}" alt="Influence arrow" height="300" width="200">
              <p id="fFollowing" class="factors"></p>
            </div>

            <form id="myform">
              <input type="radio" name="responseYN" value=1 >Yes</input>
              <input type="radio" name="responseYN" value=0 >No</input>
            </form>

            <div class="buttons">
              <!-- Button to Skip-->
              <button class="skip" id="skip">Skip</button>
              <!-- Button to submit -->
              <button class="submit" id="submit">Submit</button>
            </div>
        </div>
    </div>
  </div>

  <div class="gTResults-Container-left"> <!-- Modified class name -->
    <p><a href="{{ url_for('middleMan') }}"><button class="goToMenu">Choose Next Participant</button></a></p>
  </div>

  <div class="gTResults-Container-right"> <!-- Modified class name -->
    <p><a href="{{ url_for('resultInfo') }}"><button class="goToResult">Go To Final Results</button></a></p>
  </div>
</div>

<script>
  // Gets the participant ID and start a counter for the factors
  var p_id = int(document.getElementById("partID").innerHTML);
  var index=1;

  //Loads factors from the start
  window.onload=function() {
    $.get('/getInfoLeading/'+p_id+'/'+index,
      function(x) {
          $("#fLeading").html(x);
          $.get('/getInfoFollowing/'+p_id+'/'+index,
            function(x) {
              $("#fFollowing").html(x);
              index+=1;
            });
        });
  };

  //Updates the ratings table as the user inputs new rating
  document.getElementById("submit").addEventListener("click", updateRating);
  function updateRating() {
    var rating = document.querySelector('input[name="responseYN"]:checked').value;
    $.get('/update_rating/'+p_id+'/'+(index-1)+'/'+rating,
      function(x) {
      }
    );
  }

  //Allows the user to go through the factors either by skipping or by submitting new ratings
  document.getElementById("skip").addEventListener("click", submitButton);
  document.getElementById("submit").addEventListener("click", submitButton);

  function submitButton() {
    //Calls functins to get information on factors based on index
    $.get('/getInfoLeading/'+p_id+'/'+index,
      function(x) {
        if(x!='-1') {
          $("#fLeading").html(x);
          $.get('/getInfoFollowing/'+p_id+'/'+index,
            function(x) {
              if(x!='-1') {
                $("#fFollowing").html(x);
                index+=1;
              }
            }
          );
        }
      }
    );
   
  }
</script>
{% endblock %}